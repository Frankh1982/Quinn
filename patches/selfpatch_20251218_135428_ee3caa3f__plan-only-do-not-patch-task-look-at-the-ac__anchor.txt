Insert immediately AFTER this exact line: def build_patch_excerpt(project_name: str, source_rel_path: str, user_text: str, *, max_chars: int) -> str:
With this code:
```python
    # PLAN-ONLY HANDLER (no code changes)
    if "[PLAN ONLY" in user_text.upper():
        return (
            "PLAN-ONLY REQUEST DETECTED.\n"
            "This server is currently running in PATCH MODE only and cannot execute the requested plan-only "
            "analysis directly against 'projects/demo_project/raw/1765990273_server.py'.\n\n"
            "To proceed safely, please:\n"
            "1) Open that file in your editor.\n"
            "2) Ask for a concrete patch against the active runtime server file instead (this runtime/green/server.py),\n"
            "   or run the demo project server separately and point your browser at it.\n"
            "3) When you are ready for an actual code change in this server, restate your request WITHOUT the "
            "'[PLAN ONLY' marker so I can generate a real patch.\n"
        )
```